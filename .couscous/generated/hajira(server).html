<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title></title>

        <link rel="stylesheet" href="/css/bootstrap.min.css">
        <link rel="stylesheet" href="/css/font-awesome.min.css">
        <link rel="stylesheet" href="/css/highlight.dark.css">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="/">
                The title
                <small class="hidden-xs hidden-sm">
                    This is the default subtitle!
                </small>
            </a>

            
        </header>

        <main class="container">
            <div class="row">

                
                <section id="content" class="col-sm-12">
                    <h1 id="hajira">Hajira</h1>
<p>Hajira is a ML based attendance system, which enables user to setup a seamless attendance system using only 2 IP camera.</p>
<h2 id="step-1-install-packages">Step-1: Install packages</h2>
<h4 id="step-11-download-anacondaminiconda-and-install-it-with-python-38">Step-1.1: Download Anaconda/Miniconda and Install it with python 3.8</h4>
<p>Firstly, Install Anaconda/Miniconda: open terminal and download miniconda</p>
<pre><code>  wget https://repo.anaconda.com/miniconda/Miniconda3-py38_4.10.3-Linux-x86_64.sh</code></pre>
<h4 id="step-12">Step-1.2:</h4>
<p>After download Miniconda, install it by typing</p>
<pre><code>bash Miniconda3-py38_4.&lt;span class="hljs-number"&gt;10.3&lt;/span&gt;-Linux-x86_64.sh</code></pre>
<h4 id="step-13">Step-1.3:</h4>
<p>Create an Environment (eg: gr)</p>
<pre><code>conda create -n gr python=3.8.13</code></pre>
<h4 id="step-14">Step-1.4:</h4>
<p>Activate Environment:</p>
<pre><code>conda activate gr</code></pre>
<h2 id="step-2-install-required-packages">Step-2: Install required packages</h2>
<h4 id="step-21">Step-2.1:</h4>
<ul>
<li>Download requirements.txt from &gt;= <a href="https://drive.google.com/file/d/1cX3p9hB-SIHsg7dMWFu-_DCxoVRIxO9a/view?usp=sharing">File Link</a></li>
<li>Then run the command:</li>
</ul>
<pre><code>pip install requirements.txt</code></pre>
<h4 id="step-22optional">Step-2.2(Optional):</h4>
<ul>
<li>If there is an error to import opencv, simply run following command:</li>
</ul>
<pre><code>sudo apt-get update
sudo apt-get install ffmpeg libsm6 libxext6  -y</code></pre>
<h4 id="step-23">Step-2.3:</h4>
<ul>
<li>Install Supervisor globally:</li>
</ul>
<pre><code>sudo apt install supervisor
sudo apt update</code></pre>
<h4 id="step-24">Step-2.4:</h4>
<ul>
<li>Install Cron globally:</li>
</ul>
<pre><code>sudo apt install cron</code></pre>
<h2 id="step-3-automating-hajira-using-cronjob">Step-3: Automating Hajira using CronJob</h2>
<p>The cron command-line utility is a job scheduler on Unix-like operating systems. Users who set up and maintain software environments use cron to schedule jobs, also known as cron jobs, to run periodically at fixed times, dates, or intervals.</p>
<p>Steps is given below,</p>
<ul>
<li>Make a Launcher Sript</li>
<li>Make It Executable</li>
<li>Add Logs Directory</li>
</ul>
<h4 id="step-31-make-a-launcher-sript">Step-3.1: Make a Launcher Sript</h4>
<p>Let's create the shell script!</p>
<p>This bash file needs for startup running so that it will run automatically if it restarted.</p>
<p>create bash file in terminal</p>
<pre><code>touch RUN.sh</code></pre>
<p>Then, edit with following commands in <code>RUN.sh</code></p>
<pre><code>#!/bin/bash&lt;/span&gt;
source /home/gr/miniconda3/bin/activate gr
cd /
cd /home/gr/Local_Hajira_lite_Dev/backend
# path where the code exist
sudo python3 cam1.py &amp;
sudo python3 cam2.py &amp;
cd /</code></pre>
<p>Note: in base file, opencv and easydict may not be found while the python file running in bash. So, we need to append opencv and easydict path to program.</p>
<p>Add this path upto <code>site-packages</code> on top of <code>cam1.py1</code> and <code>cam2.py</code> files</p>
<pre><code class="language-pyhton">import sys
sys.path.append('/home/gr/miniconda3/envs/gr/lib/python3.8/site-packages')</code></pre>
<h4 id="step-32-make-it-executable">Step 3.2: Make It Executable</h4>
<p>We need to make the launcher script an executable, which we do with this command,</p>
<pre><code>chmod 755 RUN.sh</code></pre>
<p>Now test it, by typing in:</p>
<pre><code>bash RUN.sh</code></pre>
<p>For exit, type and enter:</p>
<pre><code>Ctrl+C</code></pre>
<h4 id="step-33-add-logs-directory">Step 3.3: Add Logs Directory</h4>
<p>We need to make a directory for the any errors in crontab to be logged.<br></p>
<p>Go to Path:</p>
<pre><code>/home/gr/Local_Hajira_lite_Dev/backend</code></pre>
<p>Create a logs directory by opening terminal in directory.<br></p>
<p>Then use the following command:</p>
<pre><code>mkdir logs</code></pre>
<p>the directory should have a PATH:</p>
<pre><code>/home/cpsd/Local_Hajira_lite_Dev1/backend/logs</code></pre>
<h4 id="step-4-add-task-to-your-crontab">Step 4: Add task to Your Crontab</h4>
<p>Type in termianl:</p>
<pre><code>sudo crontab -e</code></pre>
<p>This will bring up a crontab window.</p>
<p>Now, enter the line:</p>
<pre><code>@reboot bash /home/gr/Local_Hajira_lite_Dev/RUN.sh &gt;/home/gr/Local_Hajira_lite_Dev/logs/cronlog 2&amp;1</code></pre>
<p>Note: there is two paths. First one idicates to the <code>RUN.sh</code> file and second one to the logs folder.</p>
<h2 id="step-5-setting-up-supervisor">Step-5: Setting UP Supervisor</h2>
<p>Supervisor allows to monitor and control a number of processes on UNIX-like operating systems.</p>
<h4 id="step-51-configured-supervisor-file">Step-5.1: Configured supervisor file</h4>
<ul>
<li>Create a supervisor file in <code>/etc/supervisor/conf.d/</code> and configure it according to your requirements.</li>
<li>Type following command to create</li>
</ul>
<pre><code>sudo nano /etc/supervisor/conf.d/gr.conf</code></pre>
<p>The file should lool like:</p>
<pre><code>[program:gr]
directory=/home/gr/Face-Recognition-API/backend
environment=PATH=/home/gr/miniconda3/envs/gr/bin
command=/home/gr/miniconda3/envs/gr/bin/gunicorn app:app -b localhost:8080
autostart=true
autorestart=true
stderr_logfile=/home/gr/Face-Recognition-API/backend/logs/err.err.log
stdout_logfile=/home/gr/Face-Recognition-API/backend/logs/err.out.log</code></pre>
<p>Note: Edit the path as your requirments and make sure that you created logs folder.</p>
<h4 id="step-52-to-enable-the-configuration-run-the-following-commands">Step-5.2: To enable the configuration, run the following commands:</h4>
<pre><code>sudo supervisorctl reread
sudo service supervisor restart</code></pre>
<p>This should start a new process. To check the status of all monitored apps, use the following command:</p>
<pre><code>sudo supervisorctl status</code></pre>
<p>Important: if you make any changes in the code and want to get updated results, you need to restart the supervisor by following commands:</p>
<pre><code>sudo supervisorctl restart all</code></pre>
<h2 id="step-6-setup-nginx">Step-6: Setup nginx</h2>
<p>Nginx is an HTTP and reverse proxy server.</p>
<p>Before proceed, make sure that ports like 80 or 8080 are opened and generated by admin of the vm.</p>
<p>Let's define a server block for our flask app.</p>
<pre><code>sudo nano /etc/nginx/conf.d/virtual.conf</code></pre>
<p>Modify the file as below:</p>
<pre><code class="language-bash">server {
    listen       80;
    server_name  52.163.71.151;

    location / {
        proxy_pass http://127.0.0.1:8080;
    }
}</code></pre>
<p>Note: <code>server_name</code> is basically the public ip of the virtual machine and proxy_pass is the refer to the flask app with ports running.</p>
<p>Proxy pass directive must be the same port on which the gunicorn process is listening.</p>
<p>Restart the nginx web server.</p>
<pre><code>sudo nginx -t
sudo service nginx restart</code></pre>
<p>Congratulations! Now the Flask app is successfully deployed using a configured nginx, gunicorn and supervisor and ready to serve.</p>
                </section>

            </div>
        </main>

        <footer>
            <div class="container">
                <p class="text-muted">
                    website generated with <a href="http://couscous.io" title="Markdown website generator">Couscous</a>
                </p>
            </div>
        </footer>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//yastatic.net/highlightjs/8.2/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>
        <!-- Livereload -->
        <script>
            document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] +
                    ':35729/livereload.js?snipver=1"></' + 'script>')
        </script>
        <!-- End Livereload -->
    </body>
</html>
